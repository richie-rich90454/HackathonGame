let isPlaying=!1,midiData=null,synth=null;async function initAudio(){synth=new Tone.PolySynth(Tone.FMSynth,{harmonicity:3,modulationIndex:10,oscillator:{type:"sine"},envelope:{attack:.002,decay:1.2,sustain:.3,release:1.5},modulation:{type:"triangle"},modulationEnvelope:{attack:.002,decay:.5,sustain:0,release:.5}}).toDestination()}async function loadMidi(){try{let t=await fetch("hackathon_game.mid");if(!t.ok)throw new Error(t.status);let a=await t.arrayBuffer();return new Midi(a)}catch(t){return console.error("MIDI load failed:",t),null}}async function startMusic(){if(synth||await initAudio(),midiData||(midiData=await loadMidi()),!midiData)return;await Tone.start(),Tone.Transport.cancel();let t=t=>{midiData.tracks.forEach((a=>{a.notes.forEach((a=>{synth.triggerAttackRelease(a.name,a.duration,t+a.time,.75*a.velocity)}))}))},a=Tone.now()+.1;t(a),Tone.Transport.scheduleRepeat((a=>{t(a)}),midiData.duration),midiData.header.tempos.length&&(Tone.Transport.bpm.value=midiData.header.tempos[0].bpm),Tone.Transport.timeSignature=[3,4],Tone.Transport.start(a),isPlaying=!0}window.addEventListener("DOMContentLoaded",(async()=>{await initAudio(),await loadMidi();let t=async()=>{isPlaying||await startMusic(),window.removeEventListener("click",t),window.removeEventListener("keydown",t)};window.addEventListener("click",t),window.addEventListener("keydown",t)}));